{"version":3,"sources":["index.js"],"names":["pc","insertBandwidthLimit","sdpLines","index","limit","search","AUDIO","StaticConfig","meetings","bandwidth","audio","video","splice","SDP","B_LINE","setMaxFs","sdp","level","QUALITY_LEVELS","HIGH","MAX_FRAMESIZES","ParameterError","replaceSdp","maxFsLine","MAX_FS","replace","checkH264Support","videoPresent","match","h264Present","validateSdp","parsedSdp","sdpTransform","parse","media","forEach","mediaLine","candidates","length","LoggerProxy","logger","error","BAD_MEDIA_PORTS","includes","port","icePwd","iceUfrag","limitBandwidth","offerSdp","split","CARRIAGE_RETURN","i","M_LINE","join","setContentSlides","screenPc","A_CONTENT_SLIDES","iceCandidate","peerConnection","remoteQualityLevel","resolve","timeout","setTimeout","localDescription","RETRY_TIMEOUT","ICE_TIMEOUT","onicecandidate","evt","candidate","clearTimeout","replaceTrack","track","senders","getSenders","sender","kind","err","addStream","stream","bowser","msedge","tracksPresent","find","getTracks","addTrack","setRemoteSessionDetails","typeStr","remoteSdp","meetingId","log","signalingState","Metrics","postEvent","event","eventType","REMOTE_SDP_RECEIVED","data","canProceed","errors","generateErrorPayload","name","MEDIA_ENGINE","HAVE_LOCAL_OFFER","STABLE","OFFER","setRemoteDescription","window","RTCSessionDescription","type","then","catch","reject","MediaError","createOffer","description","setLocalDescription","LOCAL_SDP_GENERATED","close","rollBackLocalDescription","ROLLBACK","updatePeerConnection","params","createAnswer","peerconnection","HAVE_REMOTE_OFFER","sdpConstraints","answer","connectionState","PEER_CONNECTION_STATE","CLOSED","setPeerConnectionEvents","meeting","mediaProperties","connectionFailed","reconnectionManager","iceState","reconnect","networkDisconnect","ICE_END","oniceconnectionstatechange","info","iceConnectionState","ICE_STATE","CHECKING","ICE_START","COMPLETED","CONNECTED","setNetworkStatus","NETWORK_STATUS","iceReconnected","DISCONNECTED","waitForIceReconnect","FAILED","onconnectionstatechange","CONNECTION_STATE","NEW","CONNECTING"],"mappings":"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","file":"index.js","sourcesContent":["/* eslint-disable */\n// We need to figure out how to pass a webex logger instance to these util files\n\n/* globals window, RTCSessionDescription */\n\nimport bowser from 'bowser';\nimport sdpTransform from 'sdp-transform'; // https://github.com/clux/sdp-transform\n\nimport Metrics from '../metrics';\nimport LoggerProxy from '../common/logs/logger-proxy';\nimport StaticConfig from '../common/config';\nimport {\n  RETRY_TIMEOUT,\n  ICE_TIMEOUT,\n  AUDIO,\n  SDP,\n  ICE_STATE,\n  CONNECTION_STATE,\n  NETWORK_STATUS,\n  PEER_CONNECTION_STATE,\n  OFFER,\n  QUALITY_LEVELS,\n  MAX_FRAMESIZES\n} from '../constants';\n\nimport {error, eventType} from '../metrics/config'\n\nimport MediaError from '../common/errors/media';\nimport ParameterError from '../common/errors/parameter';\n\n/**\n * @export\n * @public\n */\nconst pc = {};\n\n/**\n * munges the bandwidth limit into the sdp\n * @param {String} sdpLines\n * @param {Number} index\n * @returns {String}\n */\nconst insertBandwidthLimit = (sdpLines, index) => {\n  // eslint-disable-next-line no-warning-comments\n  // TODO convert to sdp parser\n  let limit;\n  if (sdpLines[index].search(AUDIO) !== -1) {\n    limit = StaticConfig.meetings.bandwidth.audio;\n  } else {\n    limit = StaticConfig.meetings.bandwidth.video;\n  }\n  sdpLines.splice(index + 1, 0, `${SDP.B_LINE}:${limit}`);\n  return sdpLines;\n};\n\n/**\n * needed for calliope max-fs\n * @param {String} sdp\n * @param {String} [level=QUALITY_LEVELS.HIGH] quality level for max-fs\n * @returns {String}\n */\nconst setMaxFs = (sdp, level = QUALITY_LEVELS.HIGH) => {\n  if (!MAX_FRAMESIZES[level]) {\n    throw new ParameterError(`setMaxFs: unable to set max framesize, value for level \"${level}\" is not defined`)\n  }\n  // eslint-disable-next-line no-warning-comments\n  // TODO convert with sdp parser, no munging\n  let replaceSdp = sdp;\n  const maxFsLine = `${SDP.MAX_FS}${MAX_FRAMESIZES[level]}`\n  replaceSdp = replaceSdp.replace(/(\\na=fmtp:(\\d+).*level-asymmetry-allowed=1.*)/gi, `$1;${maxFsLine}`)\n  return replaceSdp;\n};\n\n/**\n * checks that sdp has h264 codec in it\n * @param {String} sdp\n * @returns {boolean}\n */\nconst checkH264Support = (sdp) => {\n  // eslint-disable-next-line no-warning-comments\n  // TODO convert to sdp parser to read rtp.codec\n  const videoPresent = sdp.match(/\\nm=video.*/g);\n  const h264Present = sdp.match(/\\na=rtpmap:\\d+\\sH264.*/g);\n  if (videoPresent) {\n    return !!h264Present;\n  }\n  return true;\n};\n\n/**\n * validates the sdp, checks port, candidates, and ice info\n * @param {String} sdp\n * @returns {Boolean}\n */\nconst validateSdp = (sdp) => {\n  const parsedSdp = sdpTransform.parse(sdp);\n  parsedSdp.media.forEach((mediaLine) => {\n    if (mediaLine.candidates && mediaLine.candidates.length === 0) {\n      LoggerProxy.logger.error('PeerConnectionManager:index#validateSdp --> iceCandidate: Ice candadate never completed');\n      return false;\n    }\n    if (SDP.BAD_MEDIA_PORTS.includes(mediaLine.port)) {\n      LoggerProxy.logger.error('PeerConnectionManager:index#validateSdp --> iceCandidate: Found invalid port number for the ice candidate');\n      return false;\n    }\n    if (!mediaLine.icePwd || !mediaLine.iceUfrag) {\n      LoggerProxy.logger.error('PeerConnectionManager:index#validateSdp --> iceCandidate: ice ufrag and password not found');\n      return false;\n    }\n    return true;\n  });\n};\n\n/**\n * munges the bandwidth into the sdp\n * @param {String} sdp\n * @returns {String}\n */\nconst limitBandwidth = (sdp) => {\n  // TODO convert to sdp parser\n  let offerSdp = sdp;\n  let sdpLines = offerSdp.split(SDP.CARRIAGE_RETURN);\n\n  for (let i = 0; i < sdpLines.length; i += 1) {\n    if (sdpLines[i].search(SDP.M_LINE) !== -1) {\n      sdpLines = insertBandwidthLimit(sdpLines, i);\n    }\n  }\n  offerSdp = sdpLines.join(SDP.CARRIAGE_RETURN);\n  return offerSdp;\n};\n\n/**\n * makes sure the screen pc sdp has content:slides for server\n * @param {RTCPeerConnection} screenPC\n * @returns {RTCPeerConnection}\n */\npc.setContentSlides = (screenPc) => {\n  if (screenPc && screenPc.sdp) {\n    screenPc.sdp += `${SDP.A_CONTENT_SLIDES}${SDP.CARRIAGE_RETURN}`;\n  }\n  return screenPc;\n};\n\n/**\n * handles ice trickling and establishes ICE connection onto peer connection object\n * @param {Object} peerConnection\n * @param {Object} options\n * @param {String} options.remoteQualityLevel\n * @returns {RTCPeerConnection}\n */\npc.iceCandidate = (peerConnection, {remoteQualityLevel}) =>\n  new Promise((resolve) => {\n    // TODO: we dont need timeout as we can check the api state and validate.\n    const timeout = setTimeout(() => {\n      peerConnection.sdp = limitBandwidth(peerConnection.localDescription.sdp);\n      peerConnection.sdp = setMaxFs(peerConnection.sdp, remoteQualityLevel);\n      peerConnection.sdp = peerConnection.sdp.replace(/\\na=extmap.*/g, '');\n\n      if (!validateSdp(peerConnection.sdp)) {\n        setTimeout(() => {\n          resolve(peerConnection);\n        }, RETRY_TIMEOUT);\n      } else {\n        resolve(peerConnection);\n      }\n    }, ICE_TIMEOUT);\n\n    peerConnection.onicecandidate = (evt) => {\n      if (!evt.candidate && !peerConnection.sdp) {\n        peerConnection.sdp = limitBandwidth(peerConnection.localDescription.sdp);\n        peerConnection.sdp = setMaxFs(peerConnection.sdp, remoteQualityLevel);\n        peerConnection.sdp = peerConnection.sdp.replace(/\\na=extmap.*/g, '');\n\n        if (evt.candidate === null) {\n          validateSdp(peerConnection.sdp);\n          clearTimeout(timeout);\n          resolve(peerConnection);\n        }\n      }\n    };\n  });\n\n/**\n * swapping tracks\n * @param {Object} peerConnection\n * @param {Object} track\n * @returns {undefined}\n */\npc.replaceTrack = (peerConnection, track) => {\n  try {\n    const senders = peerConnection.getSenders();\n    if (senders.length > 0) {\n      senders.forEach((sender) => {\n        if (sender.track && sender.track.kind === track.kind) {\n          sender.replaceTrack(track);\n        }\n      });\n    }\n  } catch (err) {\n    LoggerProxy.logger.error(`PeerConnectionManager:index#replaceTrack --> Error replacing track, ${err}`);\n  }\n};\n\n/**\n * adding streams to peerConnection\n * @param {Object} peerConnection\n * @param {Object} stream\n * @returns {undefined}\n */\npc.addStream = (peerConnection, stream) => {\n  try {\n    if (stream && !bowser.msedge) {\n      const tracksPresent = peerConnection.getSenders && peerConnection.getSenders().find((sender) => sender.track != null);\n      if (tracksPresent) {\n        stream.getTracks().forEach((track) => {\n          pc.replaceTrack(peerConnection, track);\n        });\n        return;\n      }\n      stream.getTracks().forEach((track) => {\n        peerConnection.addTrack(track, stream);\n      });\n      // // TODO : may come back disable addTracks for chrome they are moving back to addStream\n      // // https://bugs.chromium.org/p/chromium/issues/detail?id=764414\n      // // https://bugs.chromium.org/p/chromium/issues/detail?id=738918#c7\n      //   peerConnection.addStream(stream);\n    } else if (bowser.msedge) {\n      peerConnection.addStream(stream);\n    } else {\n    }\n  } catch (err) {\n    LoggerProxy.logger.error(`PeerConnectionManager:index#addStream --> Error adding stream, error: ${error}`);\n  }\n};\n\n/**\n * setting the remote description\n * @param {Object} peerConnection\n * @param {String} typeStr\n * @param {String} remoteSdp\n * @param {String} meetingId\n * @returns {undefined}\n */\npc.setRemoteSessionDetails = (peerConnection, typeStr, remoteSdp, meetingId) => {\n  LoggerProxy.logger.log(`PeerConnectionManager:index#setRemoteSessionDetails --> Setting the remote description type: ${typeStr}State: ${peerConnection.signalingState}`);\n  let sdp = remoteSdp;\n\n  sdp = sdp.replace(/\\na=extmap.*/g, '');\n\n  // making sure that the remoteDescription is only set when there is a answer for offer\n  // or there is a offer from the server\n\n  if(!sdp) {\n    Metrics.postEvent({\n      event: eventType.REMOTE_SDP_RECEIVED,\n      meetingId: meetingId, data: {\n      canProceed: false,\n      errors: [Metrics.generateErrorPayload(2001, true,\n        error.name.MEDIA_ENGINE, 'missing remoteSdp')]\n    }})\n  }\n  if (peerConnection.signalingState === SDP.HAVE_LOCAL_OFFER || (peerConnection.signalingState === SDP.STABLE && typeStr === SDP.OFFER)) {\n    return peerConnection.setRemoteDescription(\n        new window.RTCSessionDescription({\n          type: typeStr,\n          sdp\n        })\n      )\n      .then(() => Metrics.postEvent({\n        event: eventType.REMOTE_SDP_RECEIVED,\n        meetingId: meetingId}))\n      .catch((error) =>  {\n        LoggerProxy.logger.error(`Peer-connection-manager:index#setRemoteDescription --> ${error} missing remotesdp`);\n        return Metrics.postEvent({\n          event: eventType.REMOTE_SDP_RECEIVED,\n          meetingId: meetingId,\n          data: {\n            canProceed: false,\n            errors: [Metrics.generateErrorPayload(2001, true,\n            error.name.MEDIA_ENGINE, 'missing remoteSdp')]\n          }\n        });\n      })\n  }\n\n    return Promise.reject(new MediaError('PeerConnection in wrong state'));\n};\n\n/**\n * create offer with a valid paramater\n * @param {Object} params\n * @param {Object} meetingProperties\n * @param {string} meetingProperties.meetingId\n * @param {string} meetingProperties.remoteQualityLevel LOW|MEDIUM|HIGH\n * @returns {RTCPeerConnection}\n */\npc.createOffer = (peerConnection, {meetingId, remoteQualityLevel}) => {\n  LoggerProxy.logger.log('PeerConnectionManager:index#createOffer --> creating a new offer');\n\n    return peerConnection\n      .createOffer()\n      .then((description) => {\n        // bug https://bugs.chromium.org/p/chromium/issues/detail?id=1020642\n        // chrome currently generates RTX line irrespective of weither the server side supports it\n        // we are removing apt as well because its associated with rtx line\n\n        description.sdp = description.sdp.replace(/\\r\\na=rtpmap:\\d+ rtx\\/\\d+/g, '');\n        description.sdp = description.sdp.replace(/\\r\\na=fmtp:\\d+ apt=\\d+/g, '');\n        peerConnection.setLocalDescription(description)\n      })\n      .then(() => pc.iceCandidate(peerConnection, {remoteQualityLevel}))\n      .then(() => {\n        peerConnection.sdp = limitBandwidth(peerConnection.localDescription.sdp);\n        peerConnection.sdp = setMaxFs(peerConnection.sdp, remoteQualityLevel);\n        if (!checkH264Support(peerConnection.sdp)) {\n          throw new MediaError('openH264 is downloading please Wait. Upload logs if not working on second try');\n        }\n        peerConnection.sdp = peerConnection.sdp.replace(/\\na=extmap.*/g, '');\n        pc.setContentSlides(peerConnection);\n\n        Metrics.postEvent({\n          event: eventType.LOCAL_SDP_GENERATED,\n          meetingId\n        });\n        return peerConnection;\n      })\n      .catch((err) => {\n        LoggerProxy.logger.error(`Peer-connection-manager:index#createOffer --> ${err}`);\n        Metrics.postEvent({\n          event: eventType.LOCAL_SDP_GENERATED,\n          meetingId,\n          data: {\n            canProceed: false,\n             errors: [\n               Metrics.generateErrorPayload(2001, true,\n              error.name.MEDIA_ENGINE)]\n        }});\n        pc.close(peerConnection);\n        throw err;\n      });\n};\n\n/**\n * rollBack local description in peerconnection\n * @param {Object} peerConnection\n * @returns {RTCPeerConnection}\n */\npc.rollBackLocalDescription = (peerConnection) => {\n  return peerConnection\n    .setLocalDescription(new RTCSessionDescription({type: SDP.ROLLBACK}))\n    .then(() => peerConnection)\n    .catch((err) => {\n      LoggerProxy.logger.error(`Peer-connection-manager:index#setLocalDescription --> ${err} `);\n      return Promise.error(err);\n    });\n};\n\n/**\n * @param {Object} params {\n * @param {Boolean} params.offerToReceiveAudio\n * @param {Boolean} params.offerToReceiveVideo\n * @param {string} params.offerSdp\n * @param {MediaStream} params.stream\n * @param {Object} meetingProperties\n * @param {string} meetingProperties.meetingId\n * @param {string} meetingProperties.remoteQualityLevel LOW|MEDIUM|HIGH\n * @returns {Promise.<Array>} [MediaSDP, ScreenSDP]\n */\npc.updatePeerConnection = (params, {meetingId, remoteQualityLevel}) => {\n  LoggerProxy.logger.log(`PeerConnectionManager:index#updatePeerConnection --> updating the peerConnection with params: ${params}`);\n\n  const {peerConnection, offerSdp} = params;\n\n  return pc.createAnswer({\n    peerConnection,\n      offerSdp: offerSdp[0]\n    }, {meetingId, remoteQualityLevel}).then((peerconnection) => {\n      // The content slides should also be set when we are sending inactive\n      pc.setContentSlides(peerconnection);\n    return Promise.resolve([peerconnection.sdp]);\n  });\n};\n\n/**\n * @param {Object} params\n * @param {Object} params.peerConnection\n * @param {Object} params.sdpConstraints\n * @param {Object} meetingProperties\n * @param {string} meetingProperties.meetingId\n * @param {string} meetingProperties.remoteQualityLevel LOW|MEDIUM|HIGH\n * @returns {RTCPeerConnection} peerConnection\n */\npc.createAnswer = (params, {meetingId, remoteQualityLevel}) => {\n  const {peerConnection} = params;\n\n  // TODO: Some times to many mercury event comes at the same time\n  // Need to maintain state of peerconnection\n  if (peerConnection.signalingState === SDP.HAVE_REMOTE_OFFER) {\n    return Promise.resolve(peerConnection);\n  }\n\n  return pc.setRemoteSessionDetails(peerConnection, OFFER, params.offerSdp, meetingId)\n    .then(() => peerConnection.createAnswer(params.sdpConstraints))\n    .then((answer) =>\n      //   if (edonusHack()) {\n      //     answer.sdp = answer.sdp.replace(/recvonly.*/g, 'sendrecv');\n      //   }\n      peerConnection.setLocalDescription(answer)\n    )\n    .then(() => pc.iceCandidate(peerConnection, {remoteQualityLevel}))\n    .then(() => {\n      peerConnection.sdp = limitBandwidth(peerConnection.localDescription.sdp);\n      peerConnection.sdp = setMaxFs(peerConnection.sdp, remoteQualityLevel);\n      if (!checkH264Support(peerConnection.sdp)) {\n        throw new MediaError('openH264 is downloading please Wait. Upload logs if not working on second try');\n      }\n\n      peerConnection.sdp = peerConnection.sdp.replace(/\\na=extmap.*/g, '');\n\n      return peerConnection;\n    })\n    .catch((err) => {\n      LoggerProxy.logger.error(`PeerConnectionManager:index#setRemoteSessionDetails --> Error creating remote session, error: ${error}`);\n    });\n};\n\n/**\n * shut down the peer connection\n * @param {Object} peerConnection\n * @returns {undefined}\n */\npc.close = (peerConnection) => {\n  // peerConnection.close() fails on firefox on network changes and gives a Dom exception\n  // To avoid this we have added a try catch block.\n  // Please refer to https://bugzilla.mozilla.org/show_bug.cgi?id=1274407 for more information\n\n  if(peerConnection && peerConnection.connectionState === PEER_CONNECTION_STATE.CLOSED) {\n    return Promise.resolve();\n  }\n  LoggerProxy.logger.log('PeerConnectionManager:index#close --> pc: close() -> closing the mediaPeerConnection');\n  return Promise.resolve()\n    .then(() => {\n      if (peerConnection && peerConnection.close) {\n        peerConnection.close();\n      }\n    });\n};\n\n\npc.setPeerConnectionEvents = (meeting) => {\n  // In case ICE fail\n  const {peerConnection} = meeting.mediaProperties;\n\n  const connectionFailed = () => {\n    if (meeting.reconnectionManager.iceState.resolve) {\n      // DISCONNECTED state triggers first then it goes to FAILED STATE\n      // sometimes the failed state can happen before 10 seconds (Which is the timer for the reconnect for ice disconnect)\n      meeting.reconnectionManager.iceState.resolve();\n    }\n\n    meeting.reconnect({networkDisconnect: true});\n    Metrics.postEvent({\n      event: eventType.ICE_END,\n      meeting,\n      data: {\n        canProceed: false,\n        errors: [\n          Metrics.generateErrorPayload(\n            2004, false, error.name.MEDIA_ENGINE\n          )]\n      }\n    });\n  };\n\n  peerConnection.oniceconnectionstatechange = () => {\n    LoggerProxy.logger.info('PeerConnectionManager:index#setPeerConnectionEvents --> ICE STATE CHANGE.');\n    switch (peerConnection.iceConnectionState) {\n      case ICE_STATE.CHECKING:\n        LoggerProxy.logger.info('PeerConnectionManager:index#setPeerConnectionEvents --> ICE STATE CHECKING.');\n        Metrics.postEvent({event: eventType.ICE_START, meeting});\n        break;\n      case ICE_STATE.COMPLETED:\n        LoggerProxy.logger.info('PeerConnectionManager:index#setPeerConnectionEvents --> ICE STATE COMPLETED.');\n        break;\n      case ICE_STATE.CONNECTED:\n        // Ice connection state goes to connected when both client and server sends STUN packets and\n        // Established connected between them. Firefox does not trigger COMPLETED and only trigger CONNECTED\n        Metrics.postEvent({event: eventType.ICE_END, meeting});\n        meeting.setNetworkStatus(NETWORK_STATUS.CONNECTED);\n        meeting.reconnectionManager.iceReconnected();\n        LoggerProxy.logger.info('PeerConnectionManager:index#setPeerConnectionEvents --> ICE STATE CONNECTED.');\n        break;\n      case ICE_STATE.CLOSED:\n        LoggerProxy.logger.info('PeerConnectionManager:index#setPeerConnectionEvents --> ICE STATE CLOSED.');\n        break;\n      case ICE_STATE.DISCONNECTED:\n        meeting.setNetworkStatus(NETWORK_STATUS.DISCONNECTED);\n        meeting.reconnectionManager.waitForIceReconnect()\n          .catch(() => {\n            LoggerProxy.logger.info('PeerConnectionManager:index#setPeerConnectionEvents --> ICE STATE DISCONNECTED. Automatic Reconnection Timed Out.');\n\n            connectionFailed();\n          });\n        LoggerProxy.logger.info('PeerConnectionManager:index#setPeerConnectionEvents --> ICE STATE DISCONNECTED.');\n        break;\n      case ICE_STATE.FAILED:\n        LoggerProxy.logger.info('PeerConnectionManager:index#setPeerConnectionEvents --> ICE STATE FAILED.');\n        // notify of ice failure\n        // Ice failure is the only indicator currently for identifying the actual connection drop\n        // Firefox takes sometime 10-15 seconds to go to failed state\n        connectionFailed();\n        break;\n      default:\n        break;\n    }\n  };\n\n  peerConnection.onconnectionstatechange = () => {\n    LoggerProxy.logger.info('PeerConnectionManager:index#setPeerConnectionEvents --> CONNECTION STATE CHANGE.');\n    switch (peerConnection.connectionState) {\n      case CONNECTION_STATE.NEW:\n        LoggerProxy.logger.info('PeerConnectionManager:index#setPeerConnectionEvents --> CONNECTION STATE NEW.');\n        break;\n      case CONNECTION_STATE.CONNECTING:\n        LoggerProxy.logger.info('PeerConnectionManager:index#setPeerConnectionEvents --> CONNECTION STATE CONNECTING.');\n        break;\n      case CONNECTION_STATE.CONNECTED:\n        LoggerProxy.logger.info('PeerConnectionManager:index#setPeerConnectionEvents --> CONNECTION STATE CONNECTED.');\n        break;\n      case CONNECTION_STATE.CLOSED:\n        LoggerProxy.logger.info('PeerConnectionManager:index#setPeerConnectionEvents --> CONNECTION STATE CLOSED.');\n        break;\n      case CONNECTION_STATE.DISCONNECTED:\n        LoggerProxy.logger.info('PeerConnectionManager:index#setPeerConnectionEvents --> CONNECTION STATE DISCONNECTED.');\n        break;\n      case CONNECTION_STATE.FAILED:\n        LoggerProxy.logger.info('PeerConnectionManager:index#setPeerConnectionEvents --> CONNECTION STATE FAILED.');\n        // Special case happens only on chrome where there is no ICE FAILED event\n        // only CONNECTION FAILED event gets triggred\n\n        connectionFailed();\n        break;\n      default:\n        break;\n    }\n  };\n};\n\nexport default pc;\n"]}